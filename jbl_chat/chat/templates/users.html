<!DOCTYPE html>
<html>
<head>
  <title>Users</title>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
</head>
<body>
  <h1>User: {{ user_fullname }} (ID: {{ user_id }})</h1>

  <h2>Other Users</h2>
  <table
    id="users-table"
    hx-get="/api/users/{{ user_id }}/"
    hx-trigger="load"
    hx-swap="none"
    hx-on="htmx:afterOnLoad: renderTable(event.detail.xhr.response)"
  >
    <thead>
      <tr><th>ID</th><th>Full Name</th><th>Email</th></tr>
    </thead>

    <tbody>
      <tr><td colspan="3">Loadingâ€¦</td></tr>
    </tbody>

  </table>

  <script>
    const currentUserId = {{ user_id }};

    function renderTable(responseText) {
      const { data } = JSON.parse(responseText);
      const tbody = document.querySelector('#users-table tbody');
      tbody.innerHTML = '';

      if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3"><em>No users found.</em></td></tr>';
        return;
      }

      data.forEach(u => {
        const tr = document.createElement('tr');
        const href = `/messages/${currentUserId}/${u.id}/`;
        tr.innerHTML = `
          <td>${u.id}</td>
          <td><a href="${href}">${u.fullname}</a></td>
          <td>${u.email}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
